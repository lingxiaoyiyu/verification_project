# 上传模块测试用例

## 一、测试环境

| 项目 | 原项目(Spring Boot) | 新项目(Swoole) |
|------|---------------------|----------------|
| 访问地址 | http://127.0.0.1:1000 | http://127.0.0.1:9501 |
| 基础路径 | /basic/common/upload | /basic/common/upload |

---

## 二、测试用例

### 2.1 上传图片

#### 测试用例 TC-UP-001: 正常上传图片

**请求信息**
- 接口路径: `/basic/common/upload/img`
- 请求方式: POST
- Content-Type: multipart/form-data

**测试命令**
```bash
# 原项目
curl -X POST http://127.0.0.1:1000/basic/common/upload/img -F "file=@test.jpg"

# 新项目
curl -X POST http://127.0.0.1:9501/basic/common/upload/img -F "file=@test.jpg"
```

**预期返回**
```json
{
    "code": 0,
    "message": "上传成功",
    "data": {
        "url": "/uploads/20260205/xxx.jpg",
        "fileName": "xxx.jpg",
        "fileInfoId": "/uploads/20260205/xxx.jpg",
        "fullUrl": "/uploads/20260205/xxx.jpg"
    }
}
```

**验证点**
- [ ] code 为 0
- [ ] message 包含 "上传成功"
- [ ] data.url 非空
- [ ] data.fileName 非空

---

#### 测试用例 TC-UP-002: 上传空文件

**测试命令**
```bash
# 原项目
curl -X POST http://127.0.0.1:1000/basic/common/upload/img -F "file="

# 新项目
curl -X POST http://127.0.0.1:9501/basic/common/upload/img -F "file="
```

**预期返回**
```json
{
    "code": 非0,
    "message": "文件为空",
    "data": null
}
```

**验证点**
- [ ] code 非 0
- [ ] message 包含 "文件为空"

---

#### 测试用例 TC-UP-003: 上传非图片文件

**测试命令**
```bash
# 原项目
curl -X POST http://127.0.0.1:1000/basic/common/upload/img -F "file=@test.txt"

# 新项目
curl -X POST http://127.0.0.1:9501/basic/common/upload/img -F "file=@test.txt"
```

**预期返回**
```json
{
    "code": 非0,
    "message": "文件类型不正确，只允许上传图片",
    "data": null
}
```

**验证点**
- [ ] code 非 0
- [ ] message 包含 "文件类型不正确"

---

#### 测试用例 TC-UP-004: 上传超大图片（超过20MB）

**测试说明**
需要准备一个超过20MB的图片文件进行测试

**预期返回**
```json
{
    "code": 非0,
    "message": "文件大小超过20MB限制",
    "data": null
}
```

**验证点**
- [ ] code 非 0
- [ ] message 包含 "文件大小超过"

---

### 2.2 上传文件

#### 测试用例 TC-UP-005: 正常上传文件

**请求信息**
- 接口路径: `/basic/common/upload/file`
- 请求方式: POST
- Content-Type: multipart/form-data

**测试命令**
```bash
# 原项目
curl -X POST http://127.0.0.1:1000/basic/common/upload/file -F "file=@test.pdf"

# 新项目
curl -X POST http://127.0.0.1:9501/basic/common/upload/file -F "file=@test.pdf"
```

**预期返回**
```json
{
    "code": 0,
    "message": "上传成功",
    "data": {
        "url": "/uploads/20260205/xxx.pdf",
        "fileName": "xxx.pdf",
        "fileInfoId": "/uploads/20260205/xxx.pdf",
        "fullUrl": "/uploads/20260205/xxx.pdf"
    }
}
```

**验证点**
- [ ] code 为 0
- [ ] message 包含 "上传成功"
- [ ] data.url 非空

---

#### 测试用例 TC-UP-006: 上传空文件

**测试命令**
```bash
# 原项目
curl -X POST http://127.0.0.1:1000/basic/common/upload/file -F "file="

# 新项目
curl -X POST http://127.0.0.1:9501/basic/common/upload/file -F "file="
```

**预期返回**
```json
{
    "code": 非0,
    "message": "文件为空",
    "data": null
}
```

**验证点**
- [ ] code 非 0
- [ ] message 包含 "文件为空"

---

## 三、测试执行记录

| 用例编号 | 用例名称 | 原项目结果 | 新项目结果 | 对比结果 | 测试日期 |
|----------|----------|------------|------------|----------|----------|
| TC-UP-001 | 正常上传图片 | - | - | - | - |
| TC-UP-002 | 上传空文件(图片) | - | - | - | - |
| TC-UP-003 | 上传非图片文件 | - | - | - | - |
| TC-UP-004 | 上传超大图片 | - | - | - | - |
| TC-UP-005 | 正常上传文件 | - | - | - | - |
| TC-UP-006 | 上传空文件 | - | - | - | - |

---

## 四、注意事项

1. 测试前需要准备测试文件：
   - test.jpg - 正常图片文件
   - test.txt - 文本文件（用于测试非图片上传）
   - test.pdf - PDF文件
   - large.jpg - 超过20MB的图片文件

2. 新项目启动命令：
   ```bash
   ssh pjw_1@127.0.0.1
   # 密码: pjw622848a
   cd /cygdrive/d/SVN/WUJIE/01_platform/api_swoole/bin
   ./cups.sh start
   ```

3. 测试完成后停止新项目：
   ```bash
   ./cups.sh stop
   ```
