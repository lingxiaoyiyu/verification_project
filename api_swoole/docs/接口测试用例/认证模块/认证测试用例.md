# 认证模块测试用例

## 一、测试环境

| 项目 | 原项目(Spring Boot) | 新项目(Swoole) |
|------|---------------------|----------------|
| 访问地址 | http://127.0.0.1:1000 | http://127.0.0.1:9501 |
| 基础路径 | /basic/auth | /basic/auth |

---

## 二、登录接口测试用例

### 2.1 用户名密码登录

#### TC-AUTH-001: 正常登录

**测试命令**
```bash
# 原项目
curl -X POST http://127.0.0.1:1000/basic/auth/login/username \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"123456"}'

# 新项目
curl -X POST http://127.0.0.1:9501/basic/auth/login/username \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"123456"}'
```

**预期返回**
```json
{
    "code": 0,
    "message": "登录成功",
    "data": {
        "accessToken": "xxx..."
    }
}
```

---

#### TC-AUTH-002: 用户名不存在

**测试命令**
```bash
curl -X POST http://127.0.0.1:9501/basic/auth/login/username \
  -H "Content-Type: application/json" \
  -d '{"username":"notexist","password":"123456"}'
```

**预期返回**
```json
{
    "code": 非0,
    "message": "账号不存在"
}
```

---

#### TC-AUTH-003: 密码错误

**测试命令**
```bash
curl -X POST http://127.0.0.1:9501/basic/auth/login/username \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"wrongpassword"}'
```

**预期返回**
```json
{
    "code": 非0,
    "message": "密码错误"
}
```

---

### 2.2 邮箱密码登录

#### TC-AUTH-004: 邮箱登录成功

**测试命令**
```bash
curl -X POST http://127.0.0.1:9501/basic/auth/login/email \
  -H "Content-Type: application/json" \
  -d '{"email":"admin@example.com","password":"123456"}'
```

**预期返回**
```json
{
    "code": 0,
    "message": "登录成功",
    "data": {
        "accessToken": "xxx..."
    }
}
```

---

## 三、注册接口测试用例

### 3.1 用户名注册

#### TC-AUTH-005: 正常注册

**测试命令**
```bash
curl -X POST http://127.0.0.1:9501/basic/auth/reg/username \
  -H "Content-Type: application/json" \
  -d '{"username":"newuser123","password":"123456"}'
```

**预期返回**
```json
{
    "code": 0,
    "message": "注册成功"
}
```

---

#### TC-AUTH-006: 用户名已存在

**测试命令**
```bash
curl -X POST http://127.0.0.1:9501/basic/auth/reg/username \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"123456"}'
```

**预期返回**
```json
{
    "code": 非0,
    "message": "用户名已存在"
}
```

---

## 四、其他认证接口测试用例

### 4.1 退出登录

#### TC-AUTH-007: 正常退出

**测试命令**
```bash
# 先登录获取Token
TOKEN=$(curl -s -X POST http://127.0.0.1:9501/basic/auth/login/username \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"123456"}' | jq -r '.data.accessToken')

# 退出登录
curl -X POST http://127.0.0.1:9501/basic/auth/logout \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $TOKEN"
```

**预期返回**
```json
{
    "code": 0,
    "message": "退出成功"
}
```

---

### 4.2 刷新Token

#### TC-AUTH-008: 正常刷新Token

**测试命令**
```bash
curl -X POST http://127.0.0.1:9501/basic/auth/refresh \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $TOKEN"
```

**预期返回**
```json
{
    "code": 0,
    "message": "刷新成功",
    "data": {
        "accessToken": "新Token..."
    }
}
```

---

### 4.3 获取用户菜单

#### TC-AUTH-009: 获取菜单列表

**测试命令**
```bash
curl -X POST http://127.0.0.1:9501/basic/auth/menus \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $TOKEN"
```

**预期返回**
```json
{
    "code": 0,
    "message": "获取成功",
    "data": [...]
}
```

---

### 4.4 获取用户权限码

#### TC-AUTH-010: 获取权限码列表

**测试命令**
```bash
curl -X POST http://127.0.0.1:9501/basic/auth/codes \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $TOKEN"
```

**预期返回**
```json
{
    "code": 0,
    "message": "获取成功",
    "data": ["user:add", "user:edit", ...]
}
```

---

## 五、测试执行记录

| 用例编号 | 用例名称 | 原项目结果 | 新项目结果 | 对比结果 | 测试日期 |
|----------|----------|------------|------------|----------|----------|
| TC-AUTH-001 | 用户名密码登录 | - | - | - | - |
| TC-AUTH-002 | 用户名不存在 | - | - | - | - |
| TC-AUTH-003 | 密码错误 | - | - | - | - |
| TC-AUTH-004 | 邮箱登录成功 | - | - | - | - |
| TC-AUTH-005 | 正常注册 | - | - | - | - |
| TC-AUTH-006 | 用户名已存在 | - | - | - | - |
| TC-AUTH-007 | 正常退出 | - | - | - | - |
| TC-AUTH-008 | 刷新Token | - | - | - | - |
| TC-AUTH-009 | 获取菜单列表 | - | - | - | - |
| TC-AUTH-010 | 获取权限码 | - | - | - | - |

---

## 六、注意事项

1. 测试需要认证的接口前，需先登录获取Token
2. Token需要放在请求头Authorization中，格式为: `Bearer {token}`
3. 新项目启动命令：
   ```bash
   ssh pjw_1@127.0.0.1
   # 密码: pjw622848a
   cd /cygdrive/d/SVN/WUJIE/01_platform/api_swoole/bin
   ./cups.sh start
   ```
