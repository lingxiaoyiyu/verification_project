# 验证码模块测试用例

## 一、测试环境

| 项目 | 原项目(Spring Boot) | 新项目(Swoole) |
|------|---------------------|----------------|
| 访问地址 | http://127.0.0.1:1000 | http://127.0.0.1:9501 |
| 基础路径 | /basic/common/verifyCode | /basic/common/verifyCode |

---

## 二、测试用例

### 2.1 获取图片验证码

#### 测试用例 TC-VC-001: 正常获取图片验证码

**请求信息**
- 接口路径: `/basic/common/verifyCode/img`
- 请求方式: POST
- Content-Type: application/json
- 请求体: 无

**测试命令**
```bash
# 原项目
curl -X POST http://127.0.0.1:1000/basic/common/verifyCode/img -H "Content-Type: application/json"

# 新项目
curl -X POST http://127.0.0.1:9501/basic/common/verifyCode/img -H "Content-Type: application/json"
```

**预期返回**
```json
{
    "code": 0,
    "message": "success",
    "data": {
        "img": "data:image/png;base64,iVBORw0KGgo...",
        "key": "abc123def456..."
    }
}
```

**验证点**
- [ ] code 为 0
- [ ] data.img 以 "data:image/png;base64," 开头
- [ ] data.key 非空字符串

---

### 2.2 获取手机验证码

#### 测试用例 TC-VC-002: 正常获取手机验证码

**请求信息**
- 接口路径: `/basic/common/verifyCode/phone`
- 请求方式: POST
- Content-Type: application/json

**请求体**
```json
{
    "phoneNumber": "13800138000"
}
```

**测试命令**
```bash
# 原项目
curl -X POST http://127.0.0.1:1000/basic/common/verifyCode/phone -H "Content-Type: application/json" -d '{"phoneNumber":"13800138000"}'

# 新项目
curl -X POST http://127.0.0.1:9501/basic/common/verifyCode/phone -H "Content-Type: application/json" -d '{"phoneNumber":"13800138000"}'
```

**预期返回**
```json
{
    "code": 0,
    "message": "success",
    "data": null
}
```

**验证点**
- [ ] code 为 0
- [ ] message 包含 "成功"

---

#### 测试用例 TC-VC-003: 手机号为空

**请求体**
```json
{
    "phoneNumber": ""
}
```

**测试命令**
```bash
# 原项目
curl -X POST http://127.0.0.1:1000/basic/common/verifyCode/phone -H "Content-Type: application/json" -d '{"phoneNumber":""}'

# 新项目
curl -X POST http://127.0.0.1:9501/basic/common/verifyCode/phone -H "Content-Type: application/json" -d '{"phoneNumber":""}'
```

**预期返回**
```json
{
    "code": 非0,
    "message": "手机号不能为空",
    "data": null
}
```

**验证点**
- [ ] code 非 0
- [ ] message 包含错误信息

---

#### 测试用例 TC-VC-004: 1分钟内重复发送（频率限制）

**测试步骤**
1. 第一次发送验证码（应成功）
2. 立即再次发送验证码（应失败）

**测试命令**
```bash
# 第一次发送
curl -X POST http://127.0.0.1:9501/basic/common/verifyCode/phone -H "Content-Type: application/json" -d '{"phoneNumber":"13800138001"}'

# 第二次发送（1分钟内）
curl -X POST http://127.0.0.1:9501/basic/common/verifyCode/phone -H "Content-Type: application/json" -d '{"phoneNumber":"13800138001"}'
```

**预期返回（第二次）**
```json
{
    "code": 非0,
    "message": "1分钟内只能发送1次验证码",
    "data": null
}
```

**验证点**
- [ ] 第一次请求成功
- [ ] 第二次请求失败，提示频率限制

---

### 2.3 获取邮件验证码

#### 测试用例 TC-VC-005: 正常获取邮件验证码

**请求信息**
- 接口路径: `/basic/common/verifyCode/email`
- 请求方式: POST
- Content-Type: application/json

**请求体**
```json
{
    "email": "test@example.com"
}
```

**测试命令**
```bash
# 原项目
curl -X POST http://127.0.0.1:1000/basic/common/verifyCode/email -H "Content-Type: application/json" -d '{"email":"test@example.com"}'

# 新项目
curl -X POST http://127.0.0.1:9501/basic/common/verifyCode/email -H "Content-Type: application/json" -d '{"email":"test@example.com"}'
```

**预期返回**
```json
{
    "code": 0,
    "message": "发送成功",
    "data": {
        "key": "abc123def456..."
    }
}
```

**验证点**
- [ ] code 为 0
- [ ] message 为 "发送成功"
- [ ] data.key 非空字符串

---

#### 测试用例 TC-VC-006: 邮箱为空

**请求体**
```json
{
    "email": ""
}
```

**测试命令**
```bash
# 原项目
curl -X POST http://127.0.0.1:1000/basic/common/verifyCode/email -H "Content-Type: application/json" -d '{"email":""}'

# 新项目
curl -X POST http://127.0.0.1:9501/basic/common/verifyCode/email -H "Content-Type: application/json" -d '{"email":""}'
```

**预期返回**
```json
{
    "code": 非0,
    "message": "邮箱不能为空",
    "data": null
}
```

**验证点**
- [ ] code 非 0
- [ ] message 包含错误信息

---

## 三、测试执行记录

| 用例编号 | 用例名称 | 原项目结果 | 新项目结果 | 对比结果 | 测试日期 |
|----------|----------|------------|------------|----------|----------|
| TC-VC-001 | 正常获取图片验证码 | - | - | - | - |
| TC-VC-002 | 正常获取手机验证码 | - | - | - | - |
| TC-VC-003 | 手机号为空 | - | - | - | - |
| TC-VC-004 | 1分钟内重复发送 | - | - | - | - |
| TC-VC-005 | 正常获取邮件验证码 | - | - | - | - |
| TC-VC-006 | 邮箱为空 | - | - | - | - |

---

## 四、注意事项

1. 测试前确保原项目(Spring Boot)和新项目(Swoole)都已启动
2. 新项目启动命令：
   ```bash
   ssh pjw_1@127.0.0.1
   # 密码: pjw622848a
   cd /cygdrive/d/SVN/WUJIE/01_platform/api_swoole/bin
   ./cups.sh start
   ```
3. 测试完成后停止新项目：
   ```bash
   ./cups.sh stop
   ```
4. 频率限制测试需要使用不同的手机号，或等待限制时间过后再测试
